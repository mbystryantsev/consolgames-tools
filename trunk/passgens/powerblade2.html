<?xml version='1.0' encoding='windows-1251' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<title>Power Blade 2 (NES) Password Generator</title>
		<meta http-equiv="content-type" content="text/html; charset=windows-1251" />
		<meta http-equiv="content-style-type" content="text/css" />

		<script type="text/javascript">
			/* <![CDATA[ */
			swizzleTableFinal = [0, 6, 5, 4, 10, 1, 9, 3, 7, 8, 2, 11];
			swizzleTables = [
				[0, 2, 3, 1, 4, 6, 9, 5, 7, 8, 10, 11],
				[8, 2, 3, 6, 10, 1, 9, 5, 7, 0, 4, 11],
				[5, 4, 3, 10, 6, 0, 9, 8, 7, 1, 2, 11],
				[3, 4, 1, 2, 6, 5, 9, 10, 7, 8, 0, 11]
			];
			incrementTable = [4, 1, 3, 2, 7, 1, 3, 5, 6, 4, 5, 2];
			cellLabels = [
				'Empty',
				'Single Boomerang',
				'Star',
				'Hamburger',
				'Energy Powerup',
				'Double Boomerang',
				'Life Stock',
				'Energy Stock'
			];
			imageData = [
				'iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeAQMAAAAB/jzhAAAAA1BMVEUAAACnej3aAAAADElEQVR4nGNgGIwAAACWAAGzNRKNAAAAAElFTkSuQmCC',
				'iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeAgMAAABGXkYxAAAADFBMVEUAAAD8mDjITAz8/Py4cE9yAAAATElEQVR4nGNgoBAwJzAwzAExGIGYBcRg' +
					'AmIOVEUNDAwKqAygrglghgYDUwOYocfADWFwLlgG0cX06wdU//oFEAEGLojJcLvgtlMHAAA9UgpMGOgMaAAAAABJRU5ErkJggg',
				'iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqc' +
					'GAAAAAd0SU1FB9wJBAs0BwJBCmcAAAAdaVRYdENvbW1lbnQAAAAAAENyZWF0ZWQgd2l0aCBHSU1QZC5lBwAAAN1JREFUSMftlrENwjAQRX9Q' +
					'ShcMQ+EhXDCex6BgCBcMQ0H5JVOgIGNy2D4LBSGflOrkvPzz6SkTgIgNaoeNaoAHeBswSdBbBGfee96ungnOgN6CZBEepYfeyj0yas8u7hCb' +
					'wRk1+NNZAHHSmIskLsc9AMCeb3+21cuiBGcey5akfS5g2heWLq/qUa9tdl4tY2+64zytFtp8x/M843C6dkObwVLiGll0gVNomlIav9pcuTAk' +
					'KQRnisJQmYveFl8cnHnRZMWHdPn2O64mWZV2LXnJ5SpXjz+QAR7gnwLfAZxSJlpGs6MdAAAAAElFTkSuQmCC',
				'iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeAgMAAABGXkYxAAAADFBMVEUAAAD8mDjITAz8/Py4cE9yAAAAWUlEQVR4nGNgoBAwJzAwzAExGIGYBcRg' +
					'Yuhr4ADLcWvtgCjS2L0KwhBatRLCMMtKhTD4Q0MgDIW/hyAMLgYNCMNgVSOEIc9gCqaZWP+GcEDsCnVgQbGdOgAA3asOclERqSAAAAAASUVO' +
					'RK5CYII',
				'iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeAgMAAABGXkYxAAAADFBMVEUAAAD8mDjITAz8/Py4cE9yAAAAP0lEQVR4nGNgoBAwJzAwzAExGBnkHVhA' +
					'DCYg5gDLMdXfQFdef4EwAwYwtDMBRTggdjEwgO1iTqq/MYcS56MCAMm5DRyv/5lQAAAAAElFTkSuQmCC',
				'iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeAgMAAABGXkYxAAAADFBMVEUAAAD8mDjITAz8/Py4cE9yAAAATElEQVR4nGNgoBAwJzAwzAExGIGYBcRg' +
					'UmBg6ADLSTAwOYAZbAycUNUL1kD1VV2AMuQhShgUWBkaCOhiAurigNgl78ACsZ0VYjt1AABI0QopYZTsfwAAAABJRU5ErkJggg',
				'iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeAgMAAABGXkYxAAAADFBMVEUAAAD8mDjITAz8/Py4cE9yAAAAZUlEQVR4nGNgoBAwJzAwzAExGIGYBcRg' +
					'Yli1gAMsx/X/F0SR/tfQBjBjf2hoApixPjR0AZix6wODApixdfF/KCPgD5QR8icBxnAAM9aG/DEAW6F14c8HsKVci/9/gDhjAaU+AQIAtmQd' +
					'2LY/5AwAAAAASUVORK5CYII',
				'iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeAgMAAABGXkYxAAAADFBMVEUAAAD8mDjITAz8/Py4cE9yAAAAUklEQVR4nGNgoBAwJzAwzAExGIGYBcRg' +
					'YnYw4UBVZF8a6gBmWK1aBWFIwRkLoGqkFv//ABX5YwBhrPgDlVrx/wDYZNEQiAjQLoga5gRmqC6qAAAd1hS/ZWdMFQAAAABJRU5ErkJggg',
			];

			function calcChecksum(pass)
			{
				var checksum = 0;
					
				for (var i = 0; i < 12; i++)
				{
					checksum += pass[i];
				}
				for (var i = 0; i < 6; i++)
				{
					pass[i + 6] |= (checksum >>> i) & 1;
				}
			}
			
			function swizzlePassword(pass, clearedLevels)
			{
				var swizzTable = (clearedLevels == 0x1F) ? swizzleTableFinal : swizzleTables[clearedLevels % 4];
				var swizzledPass = [];
				for (var i = 0; i < 12; i++)
				{
					swizzledPass[i] = pass[swizzTable[i]];
				}
				for (var i = 0; i < 12; i++)
				{
					pass[i] = swizzledPass[i];
				}
			}
			
			function applyIncrementTable(pass)
			{
				for (var i = 0; i < 12; i++)
				{
					pass[i] = (pass[i] + incrementTable[i]) % 8;
				}
			}
			
			function getPassword(clearedLevels, suits)
			{
				var pass = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];

				pass[7] = (clearedLevels & 0x3) << 1;   // store low 2 bits and zero bit
				pass[9] = (clearedLevels & 0xC) >>> 1;   // store next 2 bits and zero bit
				pass[11] = (clearedLevels & 0x10) >>> 2; // store last bit and 2 zero bits

				pass[8] = (suits & 0x3) << 1; // store low 2 bits and zero bit
				pass[10] = (suits & 0xC) >>> 1; // store high 2 bits and zero bit
				
				calcChecksum(pass);
				swizzlePassword(pass, clearedLevels);
				applyIncrementTable(pass);

				return pass;
			}
			
			function preloadImages()
			{
				images = [];
				for (var i = 0; i < 8; i++)
				{
					images[i] = new Image();
					images[i].src = 'data:image/png;base64,' + imageData[i];
					images[i].alt = cellLabels[i];
				}
			}
			
			function generatePassword()
			{
				var clearedLevels = 0;
				for (var i = 4; i >= 0; i--)
				{
					clearedLevels <<= 1;
					clearedLevels |= document.getElementById('l' + i).checked ? 1 : 0;
				}
				
				if ((clearedLevels & 0xF) != 0xF)
				{
					// If not all of first 4 levels cleared
					clearedLevels &= 0xF;
					document.getElementById('l4').checked = false;
				}
				
				var suits = 0;
				for (var i = 3; i >= 0; i--)
				{
					suits <<= 1;
					suits |= document.getElementById('s' + i).checked ? 1 : 0;
				}
			
				var pass = getPassword(clearedLevels, suits);
				for (var i = 0; i < 12; i++)
				{
					images[pass[i]].src;
					var cell = document.getElementById('c' + i);
					cell.style.backgroundImage = 'url(' + images[pass[i]].src + ')';
					cell.title = images[pass[i]].alt;
				}
			}
			
			window.onload = function()
			{
				preloadImages();
				generatePassword();
			}
			/* ]]> */
		</script>
		<style type="text/css">
			td
			{
				width: 60px;
				height: 60px;
				background-repeat: no-repeat;
				background-size: cover;
			}
			#main
			{
				width: 300px;
			}
		</style>
	</head>
	<body>
		<div id="main">
			<fieldset>
				<legend>Cleared Levels</legend>
				<input id="l0" type="checkbox" onclick="generatePassword();" title="Level 1"/>
				<input id="l1" type="checkbox" onclick="generatePassword();" title="Level 2"/>
				<input id="l2" type="checkbox" onclick="generatePassword();" title="Level 3"/>
				<input id="l3" type="checkbox" onclick="generatePassword();" title="Level 4"/>
				<input id="l4" type="checkbox" onclick="generatePassword();" title="Level 5"/>
			</fieldset>
			<fieldset>
				<legend>Suits</legend>
				<input id="s0" type="checkbox" onclick="generatePassword();" title="Newt Suits"/>
				<input id="s1" type="checkbox" onclick="generatePassword();" title="Wet Suits"/>
				<input id="s2" type="checkbox" onclick="generatePassword();" title="Rocket Suits"/>
				<input id="s3" type="checkbox" onclick="generatePassword();" title="Patriot Suits"/>
			</fieldset>
			<fieldset>
				<legend>Password</legend>
				<table>
					<tbody>
						<tr>
							<td id="c0"/>
							<td id="c1"/>
							<td id="c2"/>
							<td id="c3"/>
						</tr>
						<tr>
							<td id="c4"/>
							<td id="c5"/>
							<td id="c6"/>
							<td id="c7"/>
						</tr>
						<tr>
							<td id="c8"/>
							<td id="c9"/>
							<td id="c10"/>
							<td id="c11"/>
						</tr>
					</tbody>
				</table>
			</fieldset>
			<fieldset>
				<legend>About</legend>
				Power Blade 2 (NES) Password generator<br/>
				© horror_x, 2012, <a href="http://consolgames.ru/">consolgames.ru</a>
			</fieldset>
		</div>
	</body>
</html>
